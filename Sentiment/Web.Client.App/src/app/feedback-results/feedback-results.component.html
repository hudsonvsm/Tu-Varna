<ngx-spinner [fullScreen]="true" type="ball-clip-rotate-multiple" size="medium">{{ 'FEEDBACK-RESULT' | translate }}</ngx-spinner>


<div *ngIf="!isLoadingPie" class="row">
  <div class="mt-5">
    <ngx-charts-advanced-pie-chart
      [view]="view"
      [scheme]="{domain: ['#5AA454', '#A10A28', '#C7B42C']}"
      [results]="singleData"
      [gradient]="gradient"
      [legend]="showLegend"
      [legendPosition]="legendPosition"
      [labels]="showLabels"
      label="{{ 'TOTAL' | translate }}"
      [doughnut]="isDoughnut"
      >
    </ngx-charts-advanced-pie-chart>
  </div>
</div>

<div *ngIf="!isLoading">
  <div class="form-row">
    <div class="form-group col-8 mb-1">
      <h3>{{'FEEDBACK-RESULT' | translate}}</h3>
    </div>
    <div class="form-group col-4 mb-1 text-right">
      <button type="button" (click)="retrainModel()" class="btn btn-outline-secondary">
        <i class="fas fa-cogs"></i> {{'RETRAIN_MODEL' | translate}}
      </button>
      <swal #retrainStart type="success" title="{{'RETRAIN_MODEL_START' | translate}}"
        html="{{'IT_WILL_TAKE_5' | translate}}">
      </swal>
      <swal #retrainError type="error" title="{{'RETRAIN_MODEL_FAILED' | translate}}"
        html="{{'SOMETHING_WENT_WRONG' | translate}}">
      </swal>
    </div>
  </div>

  <div class="form-group mt-3">
    <input class="form-control" type="text" (keyup)="applyFilter($event.target.value)"
      placeholder="{{'FILTER' | translate}}">
  </div>

  <table class="w-100 mat-elevation-z8" mat-table [dataSource]="dataSource">    
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <!-- Feedback Column -->
    <ng-container matColumnDef="text">
      <th mat-header-cell *matHeaderCellDef>{{'FEEDBACK' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="w-75 text-justify" (click)="getRecord(element)"> {{element.text}} </td>
    </ng-container>

    <!-- Language Column -->
    <ng-container matColumnDef="lang">
      <th mat-header-cell *matHeaderCellDef>{{'LANG' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="text-center"> {{element.language}} </td>
    </ng-container>

    <!-- Language score Column -->
    <ng-container matColumnDef="langScore">
      <th mat-header-cell *matHeaderCellDef>{{'LANG_SCORE' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="text-center">
        <mat-form-field>
          <mat-label>Marital status</mat-label>
          <mat-select [(ngModel)]="element.confirmedLanguage">
            <mat-option value="bg">{{element.languageScore.bg | percent:'2.5'}} BG</mat-option>
            <mat-option value="de">{{element.languageScore.de | percent:'2.5'}} DE</mat-option>
            <mat-option value="en">{{element.languageScore.en | percent:'2.5'}} EN</mat-option>
            <mat-option value="ru">{{element.languageScore.ru | percent:'2.5'}} RU</mat-option>
          </mat-select>
        </mat-form-field>
      </td>
    </ng-container>

    <!-- probability Column -->
    <ng-container matColumnDef="probability">
      <th mat-header-cell *matHeaderCellDef>{{'PROBABILITY' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="text-center"> {{element.sentimentProbability}} % </td>
    </ng-container>

    <!-- score Column -->
    <ng-container matColumnDef="score">
      <th mat-header-cell *matHeaderCellDef>{{'SCORE' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="text-center"> {{element.sentimentScore}} </td>
    </ng-container>

    <!-- Sentimnet Column -->
    <ng-container matColumnDef="sentiment">
      <th mat-header-cell *matHeaderCellDef>{{'SENTIMENT' | translate}} </th>
      <td mat-cell *matCellDef="let element" class="text-center">
        <i *ngIf="element.sentiment && element.sentimentScore > 0.15"
            class="far fa-smile-wink d-block display-4 text-success"></i>
        <i *ngIf="!element.sentiment && element.sentimentScore < -0.15" 
            class="far fa-sad-tear d-block display-4 text-danger"></i>
        <i *ngIf="element.sentimentScore >= -0.15 && element.sentimentScore <= 0.15" 
            class="far fa-meh display-4 text-secondary"></i>
      </td>
    </ng-container>

    <ng-container matColumnDef="Actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td class="text-right" class="text-right" mat-cell *matCellDef="let element">
        <div *ngIf="!element.sentToML">
          <button [swal]="confirmSwal" class="btn t btn-success" placement="left" ngbTooltip="{{'is-positive' | translate}}">
            <i class="fas fa-plus-circle"></i>
          </button>
          <swal #confirmSwal title="{{'CONFIRM_SENTIMENT_QUESTION' | translate}}"
            html="{{'ARE_YOU_SURE_CONFIRM' | translate}}"
            type="warning"
            reverseButtons="true"
            [showCancelButton]="true"
            (confirm)="confirmSentiment(element, false)">
          </swal>
          <button [swal]="denySwal" class="ml-3 my-2 btn btn-danger" placement="left" ngbTooltip="{{'is-negative' | translate}}">
            <i class="fas fa-minus-circle"></i>
          </button>
          <swal #denySwal title="{{'CONFIRM_SENTIMENT_QUESTION' | translate}}"
            html="{{'ARE_YOU_SURE_DENY' | translate}}"
            type="warning"
            reverseButtons="true"
            [showCancelButton]="true"
            (confirm)="confirmSentiment(element, true)">
          </swal>
        </div>
        <div *ngIf="element.sentToML">
          {{'CONFIRM_SENTIMENT_IS' | translate}}
          <i *ngIf="element.confirmedSentiment" class="ion d-block ion-md-happy display-4 text-success"></i>
          <i *ngIf="!element.confirmedSentiment" class="ion d-block ion-md-sad display-4 text-danger"></i>
        </div>
      </td>
    </ng-container>
  </table>

  <mat-paginator class="mat-elevation-z8 mb-4" [pageSize]="50" [pageSizeOptions]="[50, 100, 200]" showFirstLastButtons></mat-paginator>
</div>